<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The beginning
Nowadays to a F2Eâ€™s(aka. Front End Engineer) skills are way more complex than 3 or 4 years ago, you canâ€™t just know how to process a bunch of PSDs into html but al..."><meta name="author" content="huboo82 at gmail.com"><meta name="twitter:card" content="summary"><meta name="twitter:url" content="https://huboo.club/2019/11/build-api-endpoint-with-apollo-graphql.html"><meta name="twitter:title" content="Build your own API endpoint with Apollo GraphQL"><meta name="twitter:description" content="The beginning
Nowadays to a F2Eâ€™s(aka. Front End Engineer) skills are way more complex than 3 or 4 years ago, you canâ€™t just know how to ..."><meta name="twitter:site" content="@huboo"><meta name="twitter:creator" content="@huboo"><meta name="msvalidate.01" content="D275CF2CF512812F8996754F6917A4F2"><title>Build your own API endpoint with Apollo GraphQL</title><link rel="icon" href="/favicon.ico"><link rel="canonical" href="https://huboo.club/2019/11/build-api-endpoint-with-apollo-graphql.html"><link rel="alternate" type="application/rss+xml" title="huboo's blog" href="/atom.xml"><link rel="stylesheet" href="/assets/css/base.css?1585621224311"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-129577519-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-129577519-1');</script><script>window.BUILDTIME = 1585621224311;</script></head><body itemscope itemtype="https://schema.org/WebPage"><header class="site-header" role="banner" itemscope itemtype="https://schema.org/WPHeader"><nav class="navbar navbar-light navbar-expand-md fixed-top" itemscope itemtype="https://schema.org/SiteNavigationElement"><div class="container"><h1 class="site-logo"><a class="navbar-brand" href="/" data-pjax title="Home">hubooOo.</a></h1><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav mr-auto"><li class="nav-item"><a class="nav-link " href="/about/" data-pjax>About</a></li></ul><div class="site-search form-inline"><div class="input-group"><div class="input-group-prepend"><span class="input-group-text"><span class="icon-search"></span></span></div><input class="form-control" id="site-search" type="search" placeholder="Search..." autocomplete="off" aria-label="Search"></div><div class="search-list shadow d-none" id="site-search-result"></div></div></div></div></nav></header><main class="site-content" aria-label="Content"><div class="svg-background style-default"><div class="svg-background__overlay"></div><div class="page-hero"><div class="container"><h2>Build your own API endpoint with Apollo GraphQL</h2></div></div></div><div class="container "><div class="row"><div class="col-lg-8"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><section class="post-header"><p class="post-meta font-italic">Post in &nbsp;<time class="js-timeago" datetime="2019-11-27T11:38:12.000Z" itemprop="datePublished">November 27, 2019</time></p><p class="post-meta"><span class="icon-attach mr-3"></span><a class="card-link" href="/archives/category/graphql/" data-pjax><span class="badge badge-secondary">GraphQL</span></a></p><h2 class="post-title sr-only" itemprop="name headline">Build your own API endpoint with Apollo GraphQL<span itemprop="name"></span></h2><p class="post-meta"><span class="icon-tag mr-3"></span><a class="card-link" href="/archives/tag/pld/" data-pjax><span class="badge badge-secondary">pld</span></a><a class="card-link" href="/archives/tag/nodejs/" data-pjax><span class="badge badge-secondary">nodejs</span></a><a class="card-link" href="/archives/tag/graphql/" data-pjax><span class="badge badge-secondary">graphql</span></a><a class="card-link" href="/archives/tag/express/" data-pjax><span class="badge badge-secondary">express</span></a><a class="card-link" href="/archives/tag/apollo-server/" data-pjax><span class="badge badge-secondary">apollo-server</span></a></p></section><div class="post-content" itemprop="articleBody"><h3 id="The-beginning">The beginning</h3>
<p>Nowadays to a F2Eâ€™s(aka. Front End Engineer) skills are way more complex than 3 or 4 years ago, you canâ€™t just know how to process a bunch of PSDs into html but also have to make your pages works together, especially when you are creating a Web APP.</p>
<p>To make an APP work weâ€™ll need the API endpoint to provide necessary data so F2E can display/manipulate them and make APP alive.<br>
Here Iâ€™ll demonstrate of how to use GraphQL to create the endpoint, itâ€™s a bit related to backend stuff but no worries.</p>
<h3 id="Preparation">Preparation</h3>
<ul>
<li>Nodejs@^8.15.1</li>
<li>ES6 syntax knowledge</li>
<li>nodemon (optional)</li>
<li>Packages
<ul>
<li>apollo-server-express@^2.9.7</li>
<li>express@^4.17.1</li>
<li>faker@^4.1.0</li>
<li>graphql-tools@^4.0.6</li>
<li>morgan@^1.9.1</li>
</ul>
</li>
</ul>
<h3 id="Initial-a-NPM-project">Initial a NPM project</h3>
<a id="more"></a>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; md example &amp;&amp; <span class="string">"<span class="variable">$_</span>"</span></span><br><span class="line">&gt; npm init</span><br><span class="line">&gt; npm install apollo-server-express express faker graphql-tools morgan</span><br></pre></td></tr></table></figure>
<p>Install packages and letâ€™s check the directory structures:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ src</span><br><span class="line">â”‚   â”œâ”€â”€ app</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ apollo.js</span><br><span class="line">â”‚   â”‚   â””â”€â”€ server.js</span><br><span class="line">â”‚   â””â”€â”€ schemas</span><br><span class="line">â”‚       â”œâ”€â”€ index.js</span><br><span class="line">â”‚       â”œâ”€â”€ user.js</span><br><span class="line">â”‚       â”œâ”€â”€ ...</span><br></pre></td></tr></table></figure>
<p>We have a folder named <strong><em>app</em></strong> and a folder named <strong><em>schemas</em></strong> there will be our codesâ€™ houses then.</p>
<h3 id="Coding">Coding</h3>
<p>Step one, create a server to handle http requests, we are going to use express to do this.</p>
<p>To use GraphQL in backend we can choose <a href="https://github.com/apollographql/apollo-server/tree/master/packages/apollo-server-express" rel="external nofollow noopener noreferrer" target="_blank">Apollo Server</a>, it is a community-maintained open-source GraphQL server, and its example to Express is sample but for the reason of decoupling to modules we will have one <strong><em>apollo.js</em></strong> and another is <strong><em>server.js</em></strong>.</p>
<p>As you can see we have decoupled apollo part to <strong><em>apollo.js</em></strong>, in this file we only configure express:</p>
<ul>
<li>Use an express plugin called morgan to display serverâ€™s log in terminal console.</li>
<li>Module apollo applied as a middleware to express.</li>
<li>Server listen to port 4000 and when server start display a log shows server is ready.</li>
</ul>
<h4 id="Codesandbox">Codesandbox</h4>
<iframe
  src="https://codesandbox.io/embed/hopeful-banzai-4ex35?fontsize=14&hidenavigation=1&module=%2Fsrc%2Fapp%2Fserver.js&theme=dark"
  style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;"
  title="hopeful-banzai-4ex35"
  allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb"
  sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"
></iframe>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; npm start</span><br><span class="line">&gt; nodemon --watch &quot;src&#x2F;**&#x2F;*.js&quot; --exec node .&#x2F;src&#x2F;app&#x2F;server.js</span><br><span class="line"></span><br><span class="line">[nodemon] 1.19.4</span><br><span class="line">[nodemon] to restart at any time, enter &#96;rs&#96;</span><br><span class="line">[nodemon] watching dir(s): src&#x2F;**&#x2F;*.js</span><br><span class="line">[nodemon] watching extensions: js,mjs,json</span><br><span class="line">[nodemon] starting &#96;node .&#x2F;src&#x2F;app&#x2F;server.js&#96;</span><br><span class="line">ðŸš€ Server ready at http:&#x2F;&#x2F;localhost:4000&#x2F;graphql</span><br></pre></td></tr></table></figure>
<p>Before we start the server lets finish <strong><em>apollo.js</em></strong> now.</p>
<p>Hmm, seems nothing special just import modules and export module but letâ€™s remember the context and continue discover folder <strong><em>schemas</em></strong>.</p>
<h3 id="GraphQL-type-definition-and-resolvers">GraphQL type definition and resolvers.</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> typeDefs = <span class="string">`</span></span><br><span class="line"><span class="string">  type User &#123;</span></span><br><span class="line"><span class="string">    id: String</span></span><br><span class="line"><span class="string">    first_name: String</span></span><br><span class="line"><span class="string">    last_name: String</span></span><br><span class="line"><span class="string">    email(isReplace: Boolean = true): String</span></span><br><span class="line"><span class="string">    gender: String</span></span><br><span class="line"><span class="string">    phone: String</span></span><br><span class="line"><span class="string">    home: Address</span></span><br><span class="line"><span class="string">    work: Address</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  type Address &#123;</span></span><br><span class="line"><span class="string">    postal: String</span></span><br><span class="line"><span class="string">    city: String</span></span><br><span class="line"><span class="string">    street: String</span></span><br><span class="line"><span class="string">    secondary: String</span></span><br><span class="line"><span class="string">    country: String</span></span><br><span class="line"><span class="string">    country_code: String</span></span><br><span class="line"><span class="string">    state: String</span></span><br><span class="line"><span class="string">    state_abbr: String</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  type Query &#123;</span></span><br><span class="line"><span class="string">    users(count: Int): [User]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p>In GraphQL type definition we create two custom types named <strong><em>User</em></strong> and <strong><em>Address</em></strong> and Query is the default type every typeDefs need one.</p>
<p>We add fields to each type and restrict its value as String or <strong><em>Address</em></strong> so we know filed can be a custom type and its value will be the custom typeâ€™s fields as an Object.</p>
<p>Also the filed could have arguments and be restricted.</p>
<p>For the default Query type we also have a field <strong><em>users</em></strong> and the value is a list of <strong><em>User</em></strong>. This filed will return users we have and could be an array of object/null or null because we donâ€™t restrict the list or User to be required which represent in code would be <code>[User]!</code> Or <code>[User!]</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; always, replace, when &#125; = <span class="built_in">require</span>(<span class="string">'ramda'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resolvers = &#123;</span><br><span class="line">  Query: &#123;</span><br><span class="line">    users: <span class="function">(<span class="params">parent, &#123; count = <span class="number">10</span> &#125;, &#123; faker &#125;</span>) =&gt;</span></span><br><span class="line">      <span class="keyword">new</span> <span class="built_in">Array</span>(count).fill().map(<span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">        id: faker.random.uuid(),</span><br><span class="line">        first_name: faker.name.firstName(),</span><br><span class="line">        last_name: faker.name.lastName(),</span><br><span class="line">        email: <span class="function">(<span class="params">&#123; isReplace &#125;</span>) =&gt;</span></span><br><span class="line">          when(always(isReplace), replace(<span class="string">'@'</span>, <span class="string">' AT '</span>))(faker.internet.email()),</span><br><span class="line">        gender: faker.random.arrayElement([<span class="string">'female'</span>, <span class="string">'male'</span>]),</span><br><span class="line">        phone: faker.phone.phoneNumber(),</span><br><span class="line">        home: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">          postal: faker.address.zipCode(),</span><br><span class="line">          city: faker.address.city(),</span><br><span class="line">          street: faker.address.streetAddress(),</span><br><span class="line">          secondary: faker.address.secondaryAddress(),</span><br><span class="line">          country: faker.address.country(),</span><br><span class="line">          country_code: faker.address.countryCode(),</span><br><span class="line">          state: faker.address.state(),</span><br><span class="line">          state_abbr: faker.address.stateAbbr(),</span><br><span class="line">        &#125;),</span><br><span class="line">      &#125;)),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Look at <strong><em>resolvers</em></strong> carefully isnâ€™t it an Object to you, it has a key named Query and a sub-key named users like the type we defined in <strong><em>typeDefs</em></strong>, the function of users will be the resolver for generating users data â€“ an array of objects.</p>
<p>Loot at the functionâ€™s parameters, the second one comes from request variables the third one comes from apollo-serverâ€™s <strong><em>context</em></strong> we pass before.</p>
<h3 id="Playground">Playground</h3>
<p>Now start server by</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; npm start</span><br></pre></td></tr></table></figure>
<p>And using these queries to get your users.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">query Users($count: Int!, $isReplace: Boolean)&#123;</span><br><span class="line">  users(count: $count) &#123;</span><br><span class="line">    first_name</span><br><span class="line">    last_name</span><br><span class="line">    email(isReplace: $isReplace)</span><br><span class="line">    gender</span><br><span class="line">    phone</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Have fun with them!</p>
</div><div id="disqus_thread"></div><script>const disqus_config = function () {
  this.page.url = 'https://huboo.club/2019/11/build-api-endpoint-with-apollo-graphql.html';
  this.page.identifier = 'https://huboo.club/2019/11/build-api-endpoint-with-apollo-graphql.html';
};

(function() {
  const d = document, s = d.createElement('script');

  s.src = `https://huboo.disqus.com/embed.js`;

  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="nofollow noopener">comments powered by Disqus.</a></noscript></article></div><div class="col-lg-4"><aside class="site-sidebar" itemscope itemtype="https://schema.org/WPSideBar"><div class="p-3 mb-3 text-light rounded bg-secondary"><h4 class="font-italic">About</h4><p>A presentation layer developer's blog</p><a class="text-white" href="/about/" data-pjax>More...</a></div><div class="p-3"><h4 class="font-italic"><span class="icon-attach"></span>Categories</h4><a class="badge badge-pill badge-light" href="/archives/category/pld/" title="4 posts" data-pjax>PLD</a><a class="badge badge-pill badge-light" href="/archives/category/react/" title="4 posts" data-pjax>React</a><a class="badge badge-pill badge-light" href="/archives/category/bookmarks/" title="1 post" data-pjax>Bookmarks</a><a class="badge badge-pill badge-light" href="/archives/category/integration/" title="1 post" data-pjax>Integration</a><a class="badge badge-pill badge-light" href="/archives/category/ssl/" title="1 post" data-pjax>SSL</a><a class="badge badge-pill badge-light" href="/archives/category/graphql/" title="1 post" data-pjax>GraphQL</a></div><div class="p-3"><h4 class="font-italic"><span class="icon-tag"></span>Tags</h4><a class="badge badge-pill badge-light" href="/archives/tag/pld/" title="8 posts" data-pjax>pld</a><a class="badge badge-pill badge-light" href="/archives/tag/react/" title="4 posts" data-pjax>react</a><a class="badge badge-pill badge-light" href="/archives/tag/hooks/" title="3 posts" data-pjax>hooks</a><a class="badge badge-pill badge-light" href="/archives/tag/testing/" title="3 posts" data-pjax>testing</a><a class="badge badge-pill badge-light" href="/archives/tag/graphql/" title="3 posts" data-pjax>graphql</a><a class="badge badge-pill badge-light" href="/archives/tag/javascript/" title="2 posts" data-pjax>javascript</a><a class="badge badge-pill badge-light" href="/archives/tag/es6/" title="2 posts" data-pjax>es6</a><a class="badge badge-pill badge-light" href="/archives/tag/nodejs/" title="2 posts" data-pjax>nodejs</a><a class="badge badge-pill badge-light" href="/archives/tag/ubuntu/" title="2 posts" data-pjax>ubuntu</a><a class="badge badge-pill badge-light" href="/archives/tag/apollo/" title="2 posts" data-pjax>apollo</a><a class="badge badge-pill badge-light" href="/archives/tag/mutation/" title="2 posts" data-pjax>mutation</a><a class="badge badge-pill badge-light" href="/archives/tag/resource/" title="1 post" data-pjax>resource</a><a class="badge badge-pill badge-light" href="/archives/tag/jquery/" title="1 post" data-pjax>jquery</a><a class="badge badge-pill badge-light" href="/archives/tag/tricks/" title="1 post" data-pjax>tricks</a><a class="badge badge-pill badge-light" href="/archives/tag/dom/" title="1 post" data-pjax>dom</a><a class="badge badge-pill badge-light" href="/archives/tag/maven/" title="1 post" data-pjax>maven</a><a class="badge badge-pill badge-light" href="/archives/tag/apollo-server/" title="1 post" data-pjax>apollo-server</a><a class="badge badge-pill badge-light" href="/archives/tag/intersection-observer/" title="1 post" data-pjax>intersection-Observer</a><a class="badge badge-pill badge-light" href="/archives/tag/infinite-scroll/" title="1 post" data-pjax>infinite-scroll</a><a class="badge badge-pill badge-light" href="/archives/tag/blueprintjs/" title="1 post" data-pjax>blueprintjs</a><a class="badge badge-pill badge-light" href="/archives/tag/express/" title="1 post" data-pjax>express</a><a class="badge badge-pill badge-light" href="/archives/tag/css/" title="1 post" data-pjax>css</a></div><div class="p-3"><h4 class="font-italic"><span class="icon-calendar"></span>Archives</h4><ol class="list-unstyled"><li><a class="badge badge-light" href="/archives/2019/11/" data-pjax>November 2019</a></li><li><a class="badge badge-light" href="/archives/2019/10/" data-pjax>October 2019</a></li><li><a class="badge badge-light" href="/archives/2019/08/" data-pjax>August 2019</a></li><li><a class="badge badge-light" href="/archives/2019/07/" data-pjax>July 2019</a></li><li><a class="badge badge-light" href="/archives/2019/03/" data-pjax>March 2019</a></li><li><a class="badge badge-light" href="/archives/2019/02/" data-pjax>February 2019</a></li><li><a class="badge badge-light" href="/archives/2019/01/" data-pjax>January 2019</a></li><li><a class="badge badge-light" href="/archives/2018/11/" data-pjax>November 2018</a></li></ol></div><div class="social-network"><a href="https://twitter.com/huboo" rel="external nofollow noopener noreferrer" target="_blank"><span class="icon-twitter-circled"></span><span class="sr-only">twitter</span></a><a href="https://github.com/huboo" rel="external nofollow noopener noreferrer" target="_blank"><span class="icon-github-circled"></span><span class="sr-only">github</span></a><a href="https://www.linkedin.com/in/wayne-chen-4698bb59/" rel="external nofollow noopener noreferrer" target="_blank"><span class="icon-linkedin-circled"></span><span class="sr-only">linkedin</span></a></div></aside></div></div></div></main><footer class="site-footer" itemscope itemtype="https://schema.org/WPFooter"><div class="container"><div class="site-footer__meta"><p class="mb-0">hubooOo.<a href="//creativecommons.org/licenses/by/4.0/" rel="external nofollow noopener noreferrer" target="_blank"><span class="icon-cc"></span><span class="icon-cc-by"></span></a></p><p class="mb-0"><span class="icon-heart" title="Icons">by <a href="//designmodo.com/linecons-free/" rel="external nofollow noopener noreferrer" target="_blank">Linecons</a></span></p><p class="mb-0"><span class="icon-globe" title="Powered">by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a></span></p></div></div></footer><script src="/assets/js/main.js?1585621224312"></script></body></html>